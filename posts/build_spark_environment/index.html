<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建 | 风萧古道 - 勤学苦练，年复一年</title><meta name=keywords content><meta name=description content="系统及软件配置 系统配置 内存：16g 2400 cpu：i5 9400F
软件配置 Windows 10 1903版本 VMware workstation 15.10 CentOS centos-release-7-7.1908.0.el7.centos.x86_64 Java jdk-8u241-linux-x64.tar.gz Scala scala-2.11.8.tgz 值得一提的是，win10 1903版本与VMware 15.10之前的版本不兼容，会出现卡死（虚拟机繁忙）的问题，该问题在15.10版本解决。 资源来源于网络： VMware 15.10 链接：https://pan.baidu.com/s/1bpF3M1V3qPydQgGl-hUC1g 提取码：sb8t CentOS 7.7 链接：https://pan.baidu.com/s/1xFOlCvNrmXXwciVNOL2Pew 提取码：wxdx Java jdk-8u241-linux-x64.tar.gz 链接：https://pan.baidu.com/s/1E1TyObvyO6iQUW44lTCqDQ 提取码：6xw9 Scala scala-2.11.8.tgz 链接：https://pan.baidu.com/s/1TQB-wnffHh0i2aqzzfSi6A 提取码：iowh
安装前的准备 查看Windows下的网络配置 以Windows 10 1903为例（windows下控制台输入“winver”可以看自己windows版本），在控制面板->网络和Internet->网络连接中，可以看到本机上的网络配置。本次搭建这个集群，我们需要虚拟机和物理机（也就是windows）共用一个网络，所以需要使用桥接模式。 本人电脑联网时使用的是这个WLAN 2，它使用的网卡是Realtek 8821AE &mldr;. 的，记住这个名字。
配置VMware 虚拟网络编辑器 使用管理员权限打开VMware，菜单栏的编辑->虚拟网络适配器：将桥接模式的“桥接到”指向刚才记下的Realtek 8821AE，点击确定保存配置。 同时还要记住我WLAN 2这张网卡的网络配置信息：（windows cmd输入ipconfig查看） 集群及网络配置 根据刚才WLAN 2网络配置信息可知，我的虚拟机的网卡只能配置为192.168.3.***。 你得根据自己网卡上的网络配置去修改虚拟机网卡配置。
序号 IP地址 机器名 运行进程 核数/内存 用户名 1 192.168.3.30 master NN/SNN/DN/RM"><meta name=author content="JohnathanLin"><link rel=canonical href=https://windypath.com/posts/build_spark_environment/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.03e6bd00cf676d2c90cd9889b40e04c3c44fef75014399af7322c87da1ebda9d.css integrity="sha256-A+a9AM9nbSyQzZiJtA4Ew8RP73UBQ5mvcyLIfaHr2p0=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://windypath.com/posts/build_spark_environment/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建"><meta property="og:description" content="系统及软件配置 系统配置 内存：16g 2400 cpu：i5 9400F
软件配置 Windows 10 1903版本 VMware workstation 15.10 CentOS centos-release-7-7.1908.0.el7.centos.x86_64 Java jdk-8u241-linux-x64.tar.gz Scala scala-2.11.8.tgz 值得一提的是，win10 1903版本与VMware 15.10之前的版本不兼容，会出现卡死（虚拟机繁忙）的问题，该问题在15.10版本解决。 资源来源于网络： VMware 15.10 链接：https://pan.baidu.com/s/1bpF3M1V3qPydQgGl-hUC1g 提取码：sb8t CentOS 7.7 链接：https://pan.baidu.com/s/1xFOlCvNrmXXwciVNOL2Pew 提取码：wxdx Java jdk-8u241-linux-x64.tar.gz 链接：https://pan.baidu.com/s/1E1TyObvyO6iQUW44lTCqDQ 提取码：6xw9 Scala scala-2.11.8.tgz 链接：https://pan.baidu.com/s/1TQB-wnffHh0i2aqzzfSi6A 提取码：iowh
安装前的准备 查看Windows下的网络配置 以Windows 10 1903为例（windows下控制台输入“winver”可以看自己windows版本），在控制面板->网络和Internet->网络连接中，可以看到本机上的网络配置。本次搭建这个集群，我们需要虚拟机和物理机（也就是windows）共用一个网络，所以需要使用桥接模式。 本人电脑联网时使用的是这个WLAN 2，它使用的网卡是Realtek 8821AE &mldr;. 的，记住这个名字。
配置VMware 虚拟网络编辑器 使用管理员权限打开VMware，菜单栏的编辑->虚拟网络适配器：将桥接模式的“桥接到”指向刚才记下的Realtek 8821AE，点击确定保存配置。 同时还要记住我WLAN 2这张网卡的网络配置信息：（windows cmd输入ipconfig查看） 集群及网络配置 根据刚才WLAN 2网络配置信息可知，我的虚拟机的网卡只能配置为192.168.3.***。 你得根据自己网卡上的网络配置去修改虚拟机网卡配置。
序号 IP地址 机器名 运行进程 核数/内存 用户名 1 192.168.3.30 master NN/SNN/DN/RM"><meta property="og:type" content="article"><meta property="og:url" content="https://windypath.com/posts/build_spark_environment/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-23T17:42:09+08:00"><meta property="article:modified_time" content="2020-05-23T17:42:09+08:00"><meta property="og:site_name" content="Windypath"><meta name=twitter:card content="summary"><meta name=twitter:title content="搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建"><meta name=twitter:description content="系统及软件配置 系统配置 内存：16g 2400 cpu：i5 9400F
软件配置 Windows 10 1903版本 VMware workstation 15.10 CentOS centos-release-7-7.1908.0.el7.centos.x86_64 Java jdk-8u241-linux-x64.tar.gz Scala scala-2.11.8.tgz 值得一提的是，win10 1903版本与VMware 15.10之前的版本不兼容，会出现卡死（虚拟机繁忙）的问题，该问题在15.10版本解决。 资源来源于网络： VMware 15.10 链接：https://pan.baidu.com/s/1bpF3M1V3qPydQgGl-hUC1g 提取码：sb8t CentOS 7.7 链接：https://pan.baidu.com/s/1xFOlCvNrmXXwciVNOL2Pew 提取码：wxdx Java jdk-8u241-linux-x64.tar.gz 链接：https://pan.baidu.com/s/1E1TyObvyO6iQUW44lTCqDQ 提取码：6xw9 Scala scala-2.11.8.tgz 链接：https://pan.baidu.com/s/1TQB-wnffHh0i2aqzzfSi6A 提取码：iowh
安装前的准备 查看Windows下的网络配置 以Windows 10 1903为例（windows下控制台输入“winver”可以看自己windows版本），在控制面板->网络和Internet->网络连接中，可以看到本机上的网络配置。本次搭建这个集群，我们需要虚拟机和物理机（也就是windows）共用一个网络，所以需要使用桥接模式。 本人电脑联网时使用的是这个WLAN 2，它使用的网卡是Realtek 8821AE &mldr;. 的，记住这个名字。
配置VMware 虚拟网络编辑器 使用管理员权限打开VMware，菜单栏的编辑->虚拟网络适配器：将桥接模式的“桥接到”指向刚才记下的Realtek 8821AE，点击确定保存配置。 同时还要记住我WLAN 2这张网卡的网络配置信息：（windows cmd输入ipconfig查看） 集群及网络配置 根据刚才WLAN 2网络配置信息可知，我的虚拟机的网卡只能配置为192.168.3.***。 你得根据自己网卡上的网络配置去修改虚拟机网卡配置。
序号 IP地址 机器名 运行进程 核数/内存 用户名 1 192.168.3.30 master NN/SNN/DN/RM"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://windypath.com/posts/"},{"@type":"ListItem","position":2,"name":"搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建","item":"https://windypath.com/posts/build_spark_environment/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建","name":"搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建","description":"系统及软件配置 系统配置 内存：16g 2400 cpu：i5 9400F\n软件配置 Windows 10 1903版本 VMware workstation 15.10 CentOS centos-release-7-7.1908.0.el7.centos.x86_64 Java jdk-8u241-linux-x64.tar.gz Scala scala-2.11.8.tgz 值得一提的是，win10 1903版本与VMware 15.10之前的版本不兼容，会出现卡死（虚拟机繁忙）的问题，该问题在15.10版本解决。 资源来源于网络： VMware 15.10 链接：https://pan.baidu.com/s/1bpF3M1V3qPydQgGl-hUC1g 提取码：sb8t CentOS 7.7 链接：https://pan.baidu.com/s/1xFOlCvNrmXXwciVNOL2Pew 提取码：wxdx Java jdk-8u241-linux-x64.tar.gz 链接：https://pan.baidu.com/s/1E1TyObvyO6iQUW44lTCqDQ 提取码：6xw9 Scala scala-2.11.8.tgz 链接：https://pan.baidu.com/s/1TQB-wnffHh0i2aqzzfSi6A 提取码：iowh\n安装前的准备 查看Windows下的网络配置 以Windows 10 1903为例（windows下控制台输入“winver”可以看自己windows版本），在控制面板-\u0026gt;网络和Internet-\u0026gt;网络连接中，可以看到本机上的网络配置。本次搭建这个集群，我们需要虚拟机和物理机（也就是windows）共用一个网络，所以需要使用桥接模式。 本人电脑联网时使用的是这个WLAN 2，它使用的网卡是Realtek 8821AE \u0026hellip;. 的，记住这个名字。\n配置VMware 虚拟网络编辑器 使用管理员权限打开VMware，菜单栏的编辑-\u0026gt;虚拟网络适配器：将桥接模式的“桥接到”指向刚才记下的Realtek 8821AE，点击确定保存配置。 同时还要记住我WLAN 2这张网卡的网络配置信息：（windows cmd输入ipconfig查看） 集群及网络配置 根据刚才WLAN 2网络配置信息可知，我的虚拟机的网卡只能配置为192.168.3.***。 你得根据自己网卡上的网络配置去修改虚拟机网卡配置。\n序号 IP地址 机器名 运行进程 核数/内存 用户名 1 192.168.3.30 master NN/SNN/DN/RM","keywords":[],"articleBody":"系统及软件配置 系统配置 内存：16g 2400 cpu：i5 9400F\n软件配置 Windows 10 1903版本 VMware workstation 15.10 CentOS centos-release-7-7.1908.0.el7.centos.x86_64 Java jdk-8u241-linux-x64.tar.gz Scala scala-2.11.8.tgz 值得一提的是，win10 1903版本与VMware 15.10之前的版本不兼容，会出现卡死（虚拟机繁忙）的问题，该问题在15.10版本解决。 资源来源于网络： VMware 15.10 链接：https://pan.baidu.com/s/1bpF3M1V3qPydQgGl-hUC1g 提取码：sb8t CentOS 7.7 链接：https://pan.baidu.com/s/1xFOlCvNrmXXwciVNOL2Pew 提取码：wxdx Java jdk-8u241-linux-x64.tar.gz 链接：https://pan.baidu.com/s/1E1TyObvyO6iQUW44lTCqDQ 提取码：6xw9 Scala scala-2.11.8.tgz 链接：https://pan.baidu.com/s/1TQB-wnffHh0i2aqzzfSi6A 提取码：iowh\n安装前的准备 查看Windows下的网络配置 以Windows 10 1903为例（windows下控制台输入“winver”可以看自己windows版本），在控制面板-\u003e网络和Internet-\u003e网络连接中，可以看到本机上的网络配置。本次搭建这个集群，我们需要虚拟机和物理机（也就是windows）共用一个网络，所以需要使用桥接模式。 本人电脑联网时使用的是这个WLAN 2，它使用的网卡是Realtek 8821AE …. 的，记住这个名字。\n配置VMware 虚拟网络编辑器 使用管理员权限打开VMware，菜单栏的编辑-\u003e虚拟网络适配器：将桥接模式的“桥接到”指向刚才记下的Realtek 8821AE，点击确定保存配置。 同时还要记住我WLAN 2这张网卡的网络配置信息：（windows cmd输入ipconfig查看） 集群及网络配置 根据刚才WLAN 2网络配置信息可知，我的虚拟机的网卡只能配置为192.168.3.***。 你得根据自己网卡上的网络配置去修改虚拟机网卡配置。\n序号 IP地址 机器名 运行进程 核数/内存 用户名 1 192.168.3.30 master NN/SNN/DN/RM\nMaster/Worker 1核/3G spark 2 192.168.3.31 slave1 DN/NM/Worker 1核/2G spark 3 192.168.3.32 slave2 DN/NM/Worker 1核/2G spark 用到的目录： /app,/app/soft,/app/compile,/app/spark,/home/spark 开始安装 搭建集群样板机 在VMware中安装CentOS 新建虚拟机 菜单栏，文件-\u003e新建虚拟机 选择刚才下载的CentOS镜像： 一路下一步到这里，点击“自定义硬件”把内存调成3G，网络适配器调成桥接模式，然后完成并启动。 按↑键，选中Install CentOS 7，再按Enter键开始安装。 安装CentOS 7 选择语言简体中文后，进入到这个界面： 点击这个“软件选择”，进入选择界面： 勾选GNOME桌面，然后自定义勾选需要的附加选项，我这里只选了“兼容性程序库”和“系统管理工具”，之后如果有缺少软件的话，之后再补装就好。点击左上角完成。 选择网络和主机名，可以配置网络。 配置网络 打开以太网的连接，然后点击“配置”，切到IPv4设置，输入刚才我定义的第一台虚拟机的ip地址192.168.3.30，子网掩码255.255.255.0，网关和物理机windows一样192.168.3.1（见前文），最后附加DNS服务器填入谷歌提供的8.8.8.8。 然后点一下安装位置，选择自动分区，再回来就可以点“开始安装”了。 设置用户 安装过程中，可以设置root和用户，简单设置吧以免忘记密码。 以下是我设置的root和用户（仅做学习之用，也以防忘记密码）：\n用户 密码 root root spark spark 由于密码太过简单，我们需要多按一次左上角的“完成”。 值得一提的是，如果不在这里设置root和用户，在安装结束后设置的话，系统会要求你设置比较复杂的密码。 静静等待其安装完。 重启，然后接受许可证，点完成，使用spark用户登录，再简单配置下，就正式进入系统。\n测试网络 点击应用程序-\u003eFirefox，然后访问百度，如果成功则网络连接正常。 设置机器名 用root使用vi /etc/sysconfig/network中设置内容如下：\nNETWORKING=yes HOSTNAME=master 至此，CentOS安装完成。\n设置Host映射文件 /etc/hosts内保存了网址域名/机器名与其对应的ip地址建立关联的一个“数据库”，我们根据集群规划配置： 以root的身份（先su root然后输入root的密码）在命令行用#vi /etc/hosts打开配置文件，然后按小写字母i，输入以下内容然后按Esc + :wq回车保存：\n192.168.3.30 master 192.168.3.31 slave1 192.168.3.32 slave2 设置完毕后，用#ping master看看master是否连通及检测服务器响应速度。 关闭防火墙和SELinux 关闭防火墙和SELinux的原因在于Hadoop和Spark运行过程中需要使用端口进行通信，而这些安全设施会阻拦。关闭方法： 关闭iptables时，使用root登录，在命令行终端使用#service iptables status查看iptables状态，如果显示“iptables: Firewall is not running”则iptables已关闭，如果显示iptables的配置信息，则使用如下命令关闭iptables：\nchkconfig iptables off 同样，用root用户在终端使用#vi /etc/SELinux/config打开配置文件，设置SELINUX=disable，注意需要重启才生效。 然而在我们虚拟机上并没有iptables： SELinux设置为disable。 配置运行环境 更新OpenSSL CentOS自带的OpenSSL存在bug，所以我们使用如下命令更新\nyum update openssl 当然了我自己跑了一下并没有看到需要更新，也许centos7修复了。 修改OpenSSH配置 在集群环境中需要SSH进行免密码登录，需要修改OpenSSH配置文件，确认使用RSA算法进行公钥加密并确认私钥存放文件等，需要使用root用户，使用vi /etc/ssh/sshd_config打开配置文件，打开以下三个配置项： 保存修改后使用systemctl restart sshd.service重启服务。\n将用户spark加入sudoers中 后面执行中需要使用sudo命令，故将spark加入sudoers文件中，先修改配置文件的权限：chmod u+x /etc/sudoers，再使用vi /etc/sudoers打开文件，在root ALL=(ALL)ALL后加入：\nspark ALL=(ALL) ALL 他虽然说是只读，但是你可以用root编辑，然后使用wq! 加感叹号保存。\n创建运行环境所需要的目录结构 mkdir /app chown -R spark:spark /app mkdir /app/soft mkdir /app/compile mkdir /app/spark mkdir -p /home/spark/work chown -R spark:spark /home/spark/work 安装Java和Spark环境 安装和配置JDK 安装一下vmware tools，然后把jdk的包拖进去，放到/home/spark/work中。（这个找一找centos虚拟机安装vmware tools教程吧） 解压该文件并移动到/app/soft中\ncd /home/spark/work tar -zxf jdk-8u241-linux-x64.tar.gz mv jdk1.8.0_241 /app/soft ll /app/soft 然后以root执行vi /etc/profile，设置JDK相关配置如下：\nexport JAVA_HOME=/app/soft/jdk1.8.0_241 export PATH=$JAVA_HOME/bin:$PATH export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar 保存后回到终端，输入source /etc/profile更新全局变量，然后输入java和javac看看是否安装成功。\n安装Scala 把scala安装包放入/home/spark/work中。解压该文件并移动到/app/soft中。\ncd /home/spark/work tar -zxf scala-2.11.8.tgz mv scala-2.11.8 /app/soft ll /app/soft 然后以root执行vi /etc/profile，设置JDK相关配置如下：\nexport SCALA_HOME=/app/soft/scala-2.11.8 export PATH=${SCALA_HOME}/bin:$PATH 保存后回到终端，输入source /etc/profile更新全局变量，然后输入scala -version看看是否安装成功。\n参考文献 《图解Spark：核心技术与案例实战》https://item.jd.com/12021791.html VMware设置centos7共享文件夹 https://blog.csdn.net/nesxiaogu/article/details/85274626 vmware-hgfsclient结果为空解决办法 https://blog.csdn.net/qq_43371004/article/details/103101426 ","wordCount":"255","inLanguage":"zh","datePublished":"2020-05-23T17:42:09+08:00","dateModified":"2020-05-23T17:42:09+08:00","author":{"@type":"Person","name":"JohnathanLin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://windypath.com/posts/build_spark_environment/"},"publisher":{"@type":"Organization","name":"风萧古道 - 勤学苦练，年复一年","logo":{"@type":"ImageObject","url":"https://windypath.com/%3Clink%20/%20abs%20url%3E"}}}</script><script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js></script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://windypath.com/ accesskey=h title="风萧古道 (Alt + H)">风萧古道</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://windypath.com/en/ title="Switch to English Page" aria-label="Switch to English Page">En</a></li></ul></div></div><ul id=menu><li><a href=https://windypath.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://windypath.com/categories/ title=分类><span>分类</span></a></li><li><a href=https://windypath.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://windypath.com/about/ title=关于><span>关于</span></a></li><li><a href=https://windypath.com/mybooks/ title=藏书><span>藏书</span></a></li><li><a href=https://windypath.com/myfriends/ title=朋友><span>朋友</span></a></li><li><a href=https://windypath.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>搭建Spark实战环境（3台linux虚拟机集群）（一）样板机的搭建</h1><div class=post-meta><span title='2020-05-23 17:42:09 +0800 +0800'>五月 23, 2020</span>&nbsp;·&nbsp;JohnathanLin</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e7%b3%bb%e7%bb%9f%e5%8f%8a%e8%bd%af%e4%bb%b6%e9%85%8d%e7%bd%ae aria-label=系统及软件配置>系统及软件配置</a><ul><li><a href=#%e7%b3%bb%e7%bb%9f%e9%85%8d%e7%bd%ae aria-label=系统配置>系统配置</a></li><li><a href=#%e8%bd%af%e4%bb%b6%e9%85%8d%e7%bd%ae aria-label=软件配置>软件配置</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85%e5%89%8d%e7%9a%84%e5%87%86%e5%a4%87 aria-label=安装前的准备>安装前的准备</a><ul><li><a href=#%e6%9f%a5%e7%9c%8bwindows%e4%b8%8b%e7%9a%84%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae aria-label=查看Windows下的网络配置>查看Windows下的网络配置</a></li><li><a href=#%e9%85%8d%e7%bd%aevmware-%e8%99%9a%e6%8b%9f%e7%bd%91%e7%bb%9c%e7%bc%96%e8%be%91%e5%99%a8 aria-label="配置VMware 虚拟网络编辑器">配置VMware 虚拟网络编辑器</a></li></ul></li><li><a href=#%e9%9b%86%e7%be%a4%e5%8f%8a%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae aria-label=集群及网络配置>集群及网络配置</a></li><li><a href=#%e5%bc%80%e5%a7%8b%e5%ae%89%e8%a3%85 aria-label=开始安装>开始安装</a><ul><li><a href=#%e6%90%ad%e5%bb%ba%e9%9b%86%e7%be%a4%e6%a0%b7%e6%9d%bf%e6%9c%ba aria-label=搭建集群样板机>搭建集群样板机</a><ul><li><a href=#%e5%9c%a8vmware%e4%b8%ad%e5%ae%89%e8%a3%85centos aria-label=在VMware中安装CentOS>在VMware中安装CentOS</a><ul><li><a href=#%e6%96%b0%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba aria-label=新建虚拟机>新建虚拟机</a></li><li><a href=#%e5%ae%89%e8%a3%85centos-7 aria-label="安装CentOS 7">安装CentOS 7</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e7%bd%91%e7%bb%9c aria-label=配置网络>配置网络</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e7%94%a8%e6%88%b7 aria-label=设置用户>设置用户</a></li><li><a href=#%e6%b5%8b%e8%af%95%e7%bd%91%e7%bb%9c aria-label=测试网络>测试网络</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e6%9c%ba%e5%99%a8%e5%90%8d aria-label=设置机器名>设置机器名</a></li></ul></li><li><a href=#%e8%ae%be%e7%bd%aehost%e6%98%a0%e5%b0%84%e6%96%87%e4%bb%b6 aria-label=设置Host映射文件>设置Host映射文件</a></li><li><a href=#%e5%85%b3%e9%97%ad%e9%98%b2%e7%81%ab%e5%a2%99%e5%92%8cselinux aria-label=关闭防火墙和SELinux>关闭防火墙和SELinux</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83 aria-label=配置运行环境>配置运行环境</a><ul><li><a href=#%e6%9b%b4%e6%96%b0openssl aria-label=更新OpenSSL>更新OpenSSL</a></li></ul></li><li><a href=#%e4%bf%ae%e6%94%b9openssh%e9%85%8d%e7%bd%ae aria-label=修改OpenSSH配置>修改OpenSSH配置</a></li><li><a href=#%e5%b0%86%e7%94%a8%e6%88%b7spark%e5%8a%a0%e5%85%a5sudoers%e4%b8%ad aria-label=将用户spark加入sudoers中>将用户spark加入sudoers中</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83%e6%89%80%e9%9c%80%e8%a6%81%e7%9a%84%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84 aria-label=创建运行环境所需要的目录结构>创建运行环境所需要的目录结构</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85java%e5%92%8cspark%e7%8e%af%e5%a2%83 aria-label=安装Java和Spark环境>安装Java和Spark环境</a><ul><li><a href=#%e5%ae%89%e8%a3%85%e5%92%8c%e9%85%8d%e7%bd%aejdk aria-label=安装和配置JDK>安装和配置JDK</a></li><li><a href=#%e5%ae%89%e8%a3%85scala aria-label=安装Scala>安装Scala</a></li></ul></li></ul></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae aria-label=参考文献>参考文献</a></li></ul></div></details></div><div class=post-content><h2 id=系统及软件配置>系统及软件配置<a hidden class=anchor aria-hidden=true href=#系统及软件配置>#</a></h2><h3 id=系统配置>系统配置<a hidden class=anchor aria-hidden=true href=#系统配置>#</a></h3><p>内存：16g 2400
cpu：i5 9400F</p><h3 id=软件配置>软件配置<a hidden class=anchor aria-hidden=true href=#软件配置>#</a></h3><ul><li>Windows 10 1903版本</li><li>VMware workstation 15.10</li><li>CentOS centos-release-7-7.1908.0.el7.centos.x86_64</li><li>Java jdk-8u241-linux-x64.tar.gz</li><li>Scala scala-2.11.8.tgz</li></ul><p>值得一提的是，win10 1903版本与VMware 15.10之前的版本不兼容，会出现卡死（虚拟机繁忙）的问题，该问题在15.10版本解决。
资源来源于网络：
<strong>VMware 15.10</strong> 链接：https://pan.baidu.com/s/1bpF3M1V3qPydQgGl-hUC1g 提取码：sb8t
<strong>CentOS 7.7</strong> 链接：https://pan.baidu.com/s/1xFOlCvNrmXXwciVNOL2Pew 提取码：wxdx
<strong>Java jdk-8u241-linux-x64.tar.gz</strong> 链接：https://pan.baidu.com/s/1E1TyObvyO6iQUW44lTCqDQ 提取码：6xw9
<strong>Scala scala-2.11.8.tgz</strong> 链接：https://pan.baidu.com/s/1TQB-wnffHh0i2aqzzfSi6A 提取码：iowh</p><h2 id=安装前的准备>安装前的准备<a hidden class=anchor aria-hidden=true href=#安装前的准备>#</a></h2><h3 id=查看windows下的网络配置>查看Windows下的网络配置<a hidden class=anchor aria-hidden=true href=#查看windows下的网络配置>#</a></h3><p>以Windows 10 1903为例（windows下控制台输入“winver”可以看自己windows版本），在控制面板->网络和Internet->网络连接中，可以看到本机上的网络配置。本次搭建这个集群，我们需要虚拟机和物理机（也就是windows）共用一个网络，所以需要使用桥接模式。
<img loading=lazy src=/images/spark_environment1.png alt>
本人电脑联网时使用的是这个WLAN 2，它使用的网卡是Realtek 8821AE &mldr;. 的，记住这个名字。</p><h3 id=配置vmware-虚拟网络编辑器>配置VMware 虚拟网络编辑器<a hidden class=anchor aria-hidden=true href=#配置vmware-虚拟网络编辑器>#</a></h3><p><strong>使用管理员权限</strong>打开VMware，菜单栏的编辑->虚拟网络适配器：将桥接模式的“桥接到”指向刚才记下的Realtek 8821AE，点击确定保存配置。
<img loading=lazy src=/images/spark_environment2.png alt>
同时还要记住我WLAN 2这张网卡的网络配置信息：（windows cmd输入ipconfig查看）
<img loading=lazy src=/images/spark_environment3.png alt></p><h2 id=集群及网络配置>集群及网络配置<a hidden class=anchor aria-hidden=true href=#集群及网络配置>#</a></h2><p>根据刚才WLAN 2网络配置信息可知，我的虚拟机的网卡只能配置为192.168.3.***。
你得根据自己网卡上的网络配置去修改虚拟机网卡配置。</p><table><thead><tr><th>序号</th><th>IP地址</th><th>机器名</th><th>运行进程</th><th>核数/内存</th><th>用户名</th></tr></thead><tbody><tr><td>1</td><td>192.168.3.30</td><td>master</td><td>NN/SNN/DN/RM<br>Master/Worker</td><td>1核/3G</td><td>spark</td></tr><tr><td>2</td><td>192.168.3.31</td><td>slave1</td><td>DN/NM/Worker</td><td>1核/2G</td><td>spark</td></tr><tr><td>3</td><td>192.168.3.32</td><td>slave2</td><td>DN/NM/Worker</td><td>1核/2G</td><td>spark</td></tr><tr><td>用到的目录：</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>/app,/app/soft,/app/compile,/app/spark,/home/spark</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id=开始安装>开始安装<a hidden class=anchor aria-hidden=true href=#开始安装>#</a></h2><h3 id=搭建集群样板机>搭建集群样板机<a hidden class=anchor aria-hidden=true href=#搭建集群样板机>#</a></h3><h4 id=在vmware中安装centos>在VMware中安装CentOS<a hidden class=anchor aria-hidden=true href=#在vmware中安装centos>#</a></h4><h5 id=新建虚拟机>新建虚拟机<a hidden class=anchor aria-hidden=true href=#新建虚拟机>#</a></h5><p>菜单栏，文件->新建虚拟机
<img loading=lazy src=/images/spark_environment4.png alt>
选择刚才下载的CentOS镜像：
<img loading=lazy src=/images/spark_environment5.png alt>
一路下一步到这里，点击“自定义硬件”把内存调成3G，网络适配器调成桥接模式，然后完成并启动。
<img loading=lazy src=/images/spark_environment6.png alt>
按↑键，选中Install CentOS 7，再按Enter键开始安装。
<img loading=lazy src=/images/spark_environment7.png alt></p><h5 id=安装centos-7>安装CentOS 7<a hidden class=anchor aria-hidden=true href=#安装centos-7>#</a></h5><p>选择语言简体中文后，进入到这个界面：
点击这个“软件选择”，进入选择界面：
<img loading=lazy src=/images/spark_environment8.png alt>
勾选GNOME桌面，然后自定义勾选需要的附加选项，我这里只选了“兼容性程序库”和“系统管理工具”，之后如果有缺少软件的话，之后再补装就好。点击左上角完成。
<img loading=lazy src=/images/spark_environment9.png alt>
选择网络和主机名，可以配置网络。
<img loading=lazy src=/images/spark_environment10.png alt></p><h5 id=配置网络>配置网络<a hidden class=anchor aria-hidden=true href=#配置网络>#</a></h5><p>打开以太网的连接，然后点击“配置”，切到IPv4设置，输入刚才我定义的第一台虚拟机的ip地址192.168.3.30，子网掩码255.255.255.0，网关和物理机windows一样192.168.3.1（见前文），最后附加DNS服务器填入谷歌提供的8.8.8.8。
<img loading=lazy src=/images/spark_environment11.png alt>
然后点一下安装位置，选择自动分区，再回来就可以点“开始安装”了。
<img loading=lazy src=/images/spark_environment12.png alt></p><h5 id=设置用户>设置用户<a hidden class=anchor aria-hidden=true href=#设置用户>#</a></h5><p>安装过程中，可以设置root和用户，简单设置吧以免忘记密码。
<img loading=lazy src=/images/spark_environment13.png alt>
以下是我设置的root和用户（仅做学习之用，也以防忘记密码）：</p><table><thead><tr><th>用户</th><th>密码</th></tr></thead><tbody><tr><td>root</td><td>root</td></tr><tr><td>spark</td><td>spark</td></tr><tr><td>由于密码太过简单，我们需要多按一次左上角的“完成”。</td><td></td></tr><tr><td>值得一提的是，如果不在这里设置root和用户，在安装结束后设置的话，系统会要求你设置比较复杂的密码。</td><td></td></tr><tr><td>静静等待其安装完。</td><td></td></tr></tbody></table><p>重启，然后接受许可证，点完成，使用spark用户登录，再简单配置下，就正式进入系统。</p><h5 id=测试网络>测试网络<a hidden class=anchor aria-hidden=true href=#测试网络>#</a></h5><p>点击应用程序->Firefox，然后访问百度，如果成功则网络连接正常。
<img loading=lazy src=/images/spark_environment14.png alt></p><h5 id=设置机器名>设置机器名<a hidden class=anchor aria-hidden=true href=#设置机器名>#</a></h5><p>用root使用vi /etc/sysconfig/network中设置内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NETWORKING<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>HOSTNAME<span style=color:#f92672>=</span>master
</span></span></code></pre></div><p>至此，CentOS安装完成。</p><h4 id=设置host映射文件>设置Host映射文件<a hidden class=anchor aria-hidden=true href=#设置host映射文件>#</a></h4><p>/etc/hosts内保存了网址域名/机器名与其对应的ip地址建立关联的一个“数据库”，我们根据集群规划配置：
以root的身份（先su root然后输入root的密码）在命令行用#vi /etc/hosts打开配置文件，然后按小写字母i，输入以下内容然后按Esc + :wq回车保存：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>192.168.3.30 master
</span></span><span style=display:flex><span>192.168.3.31 slave1
</span></span><span style=display:flex><span>192.168.3.32 slave2
</span></span></code></pre></div><p>设置完毕后，用#ping master看看master是否连通及检测服务器响应速度。
<img loading=lazy src=/images/spark_environment15.png alt>
<img loading=lazy src=/images/spark_environment16.png alt></p><h4 id=关闭防火墙和selinux>关闭防火墙和SELinux<a hidden class=anchor aria-hidden=true href=#关闭防火墙和selinux>#</a></h4><p>关闭防火墙和SELinux的原因在于Hadoop和Spark运行过程中需要使用端口进行通信，而这些安全设施会阻拦。关闭方法：
关闭iptables时，使用root登录，在命令行终端使用#service iptables status查看iptables状态，如果显示“iptables: Firewall is not running”则iptables已关闭，如果显示iptables的配置信息，则使用如下命令关闭iptables：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chkconfig iptables off
</span></span></code></pre></div><p>同样，用root用户在终端使用#vi /etc/SELinux/config打开配置文件，设置SELINUX=disable，注意需要重启才生效。
然而在我们虚拟机上并没有iptables：
<img loading=lazy src=/images/spark_environment17.png alt>
SELinux设置为disable。
<img loading=lazy src=/images/spark_environment18.png alt></p><h4 id=配置运行环境>配置运行环境<a hidden class=anchor aria-hidden=true href=#配置运行环境>#</a></h4><h5 id=更新openssl>更新OpenSSL<a hidden class=anchor aria-hidden=true href=#更新openssl>#</a></h5><p>CentOS自带的OpenSSL存在bug，所以我们使用如下命令更新</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum update openssl
</span></span></code></pre></div><p>当然了我自己跑了一下并没有看到需要更新，也许centos7修复了。
<img loading=lazy src=/images/spark_environment19.png alt></p><h4 id=修改openssh配置>修改OpenSSH配置<a hidden class=anchor aria-hidden=true href=#修改openssh配置>#</a></h4><p>在集群环境中需要SSH进行免密码登录，需要修改OpenSSH配置文件，确认使用RSA算法进行公钥加密并确认私钥存放文件等，需要使用root用户，使用vi /etc/ssh/sshd_config打开配置文件，打开以下三个配置项：
<img loading=lazy src=/images/spark_environment20.png alt>
保存修改后使用systemctl restart sshd.service重启服务。</p><h4 id=将用户spark加入sudoers中>将用户spark加入sudoers中<a hidden class=anchor aria-hidden=true href=#将用户spark加入sudoers中>#</a></h4><p>后面执行中需要使用sudo命令，故将spark加入sudoers文件中，先修改配置文件的权限：chmod u+x /etc/sudoers，再使用vi /etc/sudoers打开文件，在root ALL=(ALL)ALL后加入：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>spark ALL<span style=color:#f92672>=(</span>ALL<span style=color:#f92672>)</span> ALL
</span></span></code></pre></div><p><img loading=lazy src=/images/spark_environment21.png alt>
他虽然说是只读，但是你可以用root编辑，然后使用wq! 加感叹号保存。</p><h4 id=创建运行环境所需要的目录结构>创建运行环境所需要的目录结构<a hidden class=anchor aria-hidden=true href=#创建运行环境所需要的目录结构>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /app
</span></span><span style=display:flex><span>chown -R spark:spark /app
</span></span><span style=display:flex><span>mkdir /app/soft
</span></span><span style=display:flex><span>mkdir /app/compile
</span></span><span style=display:flex><span>mkdir /app/spark
</span></span><span style=display:flex><span>mkdir -p /home/spark/work
</span></span><span style=display:flex><span>chown -R spark:spark /home/spark/work
</span></span></code></pre></div><h3 id=安装java和spark环境>安装Java和Spark环境<a hidden class=anchor aria-hidden=true href=#安装java和spark环境>#</a></h3><h4 id=安装和配置jdk>安装和配置JDK<a hidden class=anchor aria-hidden=true href=#安装和配置jdk>#</a></h4><p>安装一下vmware tools，然后把jdk的包拖进去，放到/home/spark/work中。（这个找一找centos虚拟机安装vmware tools教程吧）
解压该文件并移动到/app/soft中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /home/spark/work
</span></span><span style=display:flex><span>tar -zxf jdk-8u241-linux-x64.tar.gz
</span></span><span style=display:flex><span>mv jdk1.8.0_241 /app/soft
</span></span><span style=display:flex><span>ll /app/soft
</span></span></code></pre></div><p>然后以root执行vi /etc/profile，设置JDK相关配置如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export JAVA_HOME<span style=color:#f92672>=</span>/app/soft/jdk1.8.0_241
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$JAVA_HOME/bin:$PATH
</span></span><span style=display:flex><span>export CLASSPATH<span style=color:#f92672>=</span>.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
</span></span></code></pre></div><p>保存后回到终端，输入source /etc/profile更新全局变量，然后输入java和javac看看是否安装成功。</p><h4 id=安装scala>安装Scala<a hidden class=anchor aria-hidden=true href=#安装scala>#</a></h4><p>把scala安装包放入/home/spark/work中。解压该文件并移动到/app/soft中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /home/spark/work
</span></span><span style=display:flex><span>tar -zxf scala-2.11.8.tgz
</span></span><span style=display:flex><span>mv scala-2.11.8 /app/soft
</span></span><span style=display:flex><span>ll /app/soft
</span></span></code></pre></div><p>然后以root执行vi /etc/profile，设置JDK相关配置如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export SCALA_HOME<span style=color:#f92672>=</span>/app/soft/scala-2.11.8
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>SCALA_HOME<span style=color:#e6db74>}</span>/bin:$PATH
</span></span></code></pre></div><p>保存后回到终端，输入source /etc/profile更新全局变量，然后输入scala -version看看是否安装成功。</p><h2 id=参考文献>参考文献<a hidden class=anchor aria-hidden=true href=#参考文献>#</a></h2><ul><li>《图解Spark：核心技术与案例实战》https://item.jd.com/12021791.html</li><li>VMware设置centos7共享文件夹 <a href=https://blog.csdn.net/nesxiaogu/article/details/85274626>https://blog.csdn.net/nesxiaogu/article/details/85274626</a></li><li>vmware-hgfsclient结果为空解决办法 <a href=https://blog.csdn.net/qq_43371004/article/details/103101426>https://blog.csdn.net/qq_43371004/article/details/103101426</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://windypath.com/posts/kotlin_implement_heap/><span class=title>« 上一页</span><br><span>Kotlin实现二叉堆、大顶堆、优先级队列</span></a>
<a class=next href=https://windypath.com/posts/spring_operate_mongodb/><span class=title>下一页 »</span><br><span>Springboot操作MongoDB，包括增改查及复杂操作</span></a></nav></footer></article></main><footer class=footer><span>Windypath 风萧古道 <strong>For Chinese Software</strong>. <a href=https://beian.miit.gov.cn/>闽ICP备15016446号-3</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>