<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Python连接MongoDB和Oracle实战 | 风萧古道 - 勤学苦练，年复一年</title><meta name=keywords content><meta name=description content="Python连接MongoDB 安装 首先要安装pymongo，用pip装一下就好了。
工具类python文件 以下直接给出我写的mongodb操作类
#!/usr/bin/env python # -*- coding: utf-8 -*- # @Time : 2019/12/23 14:02 # @Author : Johnathan Lin 林佳庆 &#34;&#34;&#34; 数据导入Mongo模块 &#34;&#34;&#34;  import os  import pymongo  from utils.configReader import read_mongo_config  # 设置编码 os.environ['NLS_LANG'] = 'SIMPLIFIED CHINESE_CHINA.UTF8'   def get_mongodb_collection(collection):  &#34;&#34;&#34; 根据配置文件和数据库和表得到表（collection） :param database: 数据库 :param collection: 表 :return: 表的对象 &#34;&#34;&#34;  mongo_config = read_mongo_config()  client = pymongo.MongoClient(mongo_config['client'])  db = client[mongo_config['database']]  if mongo_config['auth'] == 'True' or mongo_config['auth'] == 'true':  db."><meta name=author content="JohnathanLin"><link rel=canonical href=https://windypath.com/posts/python_connect_mongodb_and_oracle/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Python连接MongoDB和Oracle实战"><meta property="og:description" content="Python连接MongoDB 安装 首先要安装pymongo，用pip装一下就好了。
工具类python文件 以下直接给出我写的mongodb操作类
#!/usr/bin/env python # -*- coding: utf-8 -*- # @Time : 2019/12/23 14:02 # @Author : Johnathan Lin 林佳庆 &#34;&#34;&#34; 数据导入Mongo模块 &#34;&#34;&#34;  import os  import pymongo  from utils.configReader import read_mongo_config  # 设置编码 os.environ['NLS_LANG'] = 'SIMPLIFIED CHINESE_CHINA.UTF8'   def get_mongodb_collection(collection):  &#34;&#34;&#34; 根据配置文件和数据库和表得到表（collection） :param database: 数据库 :param collection: 表 :return: 表的对象 &#34;&#34;&#34;  mongo_config = read_mongo_config()  client = pymongo.MongoClient(mongo_config['client'])  db = client[mongo_config['database']]  if mongo_config['auth'] == 'True' or mongo_config['auth'] == 'true':  db."><meta property="og:type" content="article"><meta property="og:url" content="https://windypath.com/posts/python_connect_mongodb_and_oracle/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-02-09T17:06:29+08:00"><meta property="article:modified_time" content="2020-02-09T17:06:29+08:00"><meta property="og:site_name" content="Windypath"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python连接MongoDB和Oracle实战"><meta name=twitter:description content="Python连接MongoDB 安装 首先要安装pymongo，用pip装一下就好了。
工具类python文件 以下直接给出我写的mongodb操作类
#!/usr/bin/env python # -*- coding: utf-8 -*- # @Time : 2019/12/23 14:02 # @Author : Johnathan Lin 林佳庆 &#34;&#34;&#34; 数据导入Mongo模块 &#34;&#34;&#34;  import os  import pymongo  from utils.configReader import read_mongo_config  # 设置编码 os.environ['NLS_LANG'] = 'SIMPLIFIED CHINESE_CHINA.UTF8'   def get_mongodb_collection(collection):  &#34;&#34;&#34; 根据配置文件和数据库和表得到表（collection） :param database: 数据库 :param collection: 表 :return: 表的对象 &#34;&#34;&#34;  mongo_config = read_mongo_config()  client = pymongo.MongoClient(mongo_config['client'])  db = client[mongo_config['database']]  if mongo_config['auth'] == 'True' or mongo_config['auth'] == 'true':  db."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://windypath.com/posts/"},{"@type":"ListItem","position":2,"name":"Python连接MongoDB和Oracle实战","item":"https://windypath.com/posts/python_connect_mongodb_and_oracle/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Python连接MongoDB和Oracle实战","name":"Python连接MongoDB和Oracle实战","description":"Python连接MongoDB 安装 首先要安装pymongo，用pip装一下就好了。\n工具类python文件 以下直接给出我写的mongodb操作类\n#!/usr/bin/env python # -*- coding: utf-8 -*- # @Time : 2019/12/23 14:02 # @Author : Johnathan Lin 林佳庆 \u0026#34;\u0026#34;\u0026#34; 数据导入Mongo模块 \u0026#34;\u0026#34;\u0026#34;  import os  import pymongo  from utils.configReader import read_mongo_config  # 设置编码 os.environ[\u0026#39;NLS_LANG\u0026#39;] = \u0026#39;SIMPLIFIED CHINESE_CHINA.UTF8\u0026#39;   def get_mongodb_collection(collection):  \u0026#34;\u0026#34;\u0026#34; 根据配置文件和数据库和表得到表（collection） :param database: 数据库 :param collection: 表 :return: 表的对象 \u0026#34;\u0026#34;\u0026#34;  mongo_config = read_mongo_config()  client = pymongo.MongoClient(mongo_config[\u0026#39;client\u0026#39;])  db = client[mongo_config[\u0026#39;database\u0026#39;]]  if mongo_config[\u0026#39;auth\u0026#39;] == \u0026#39;True\u0026#39; or mongo_config[\u0026#39;auth\u0026#39;] == \u0026#39;true\u0026#39;:  db.","keywords":[],"articleBody":"Python连接MongoDB 安装 首先要安装pymongo，用pip装一下就好了。\n工具类python文件 以下直接给出我写的mongodb操作类\n#!/usr/bin/env python # -*- coding: utf-8 -*- # @Time : 2019/12/23 14:02 # @Author : Johnathan Lin 林佳庆 \"\"\" 数据导入Mongo模块 \"\"\"  import os  import pymongo  from utils.configReader import read_mongo_config  # 设置编码 os.environ['NLS_LANG'] = 'SIMPLIFIED CHINESE_CHINA.UTF8'   def get_mongodb_collection(collection):  \"\"\" 根据配置文件和数据库和表得到表（collection） :param database: 数据库 :param collection: 表 :return: 表的对象 \"\"\"  mongo_config = read_mongo_config()  client = pymongo.MongoClient(mongo_config['client'])  db = client[mongo_config['database']]  if mongo_config['auth'] == 'True' or mongo_config['auth'] == 'true':  db.authenticate(mongo_config['username'], mongo_config['password'])  col = db[collection]  return col   def insert_data(collection, document):  \"\"\" 将数据插入MongoDB中 :param collection:数据将插入的集合名 :param doc:数据文档 :return:无 \"\"\"  col = get_mongodb_collection(collection)  col.insert_one(document)   def insert_data_list(collection, document_list):  \"\"\" 批量插入数据到MongoDB :param collection: 数据将插入的集合名 :param document_list: 数据文档列表 :return: \"\"\"  col = get_mongodb_collection(collection)  col.insert_many(document_list)   def get_children_classify_id(parent_id):  \"\"\" 获取所有子孙节点 :param parent_id: 父节点ID :return: 所有子孙节点 \"\"\"  col = get_mongodb_collection('crawler_classify')  res = col.aggregate([  {'$match': {'classify_id': parent_id}},  {'$graphLookup': {'from': 'crawler_classify', 'startWith': '$classify_id', 'connectFromField': 'classify_id',  'connectToField': 'parent_id', 'as': 'son'}}  ])  res_list = []  for doc in res:  res_list.append(doc)  if len(res_list) == 0 or len(res_list[0]['son']) == 0:  return []  else:  return [classify['classify_id'] for classify in res_list[0]['son']]   def get_document_by_condition(collection, key, value):  \"\"\" 根据集合和单一条件查找匹配的文档 :param collection: 集合名 :param key: 键 :param value: 值 :return: 匹配的文档列表 \"\"\"  col = get_mongodb_collection(collection)  res = col.find({key: value})  res_list = []  for doc in res:  res_list.append(doc)  return res_list   def update_document(collection, condition_key, condition_value, updated_key, new_value):  \"\"\" 更新文档 :param collection: :param condition_key: :param condition_value: :param updated_key: :param new_value: :return: \"\"\"  col = get_mongodb_collection(collection)  col.update({condition_key: condition_value}, {'$set': {updated_key: new_value}})   def get_document_by_condition_list(collection, condition_list):  \"\"\" 多条件同时成立查询匹配的文档 :param collection: 集合名 :param condition_list: 条件列表（列表中的元素为{key:value}形式） :return: 匹配的文档 \"\"\"  col = get_mongodb_collection(collection)  res = col.find({'$and': condition_list})  res_list = []  for doc in res:  res_list.append(doc)  return res_list   def remove_document(collection, condition_list):  \"\"\" 删除文档 :param collection: 删除文档的集合 :param condition_list: :return: \"\"\"  col = get_mongodb_collection(collection)  col.remove({'$and': condition_list})   def update_document_condition_list_and_new_value_obj(collection, condition_list, new_value_obj):  \"\"\" 更新update文档，通过多个用“\u0026”连接的条件和新对象更新 :param collection: 集合 :param condition_list: 与条件的列表 :param new_value_obj: 要更新的新值对象 :return: \"\"\"  col = get_mongodb_collection(collection)  col.update({'$and': condition_list}, {'$set': new_value_obj}) 配置文件 配置文件长这样：\n[CONFIG] client=mongodb://localhost:27017/ auth=False username=xxx password=xxx database=yyy 获取集合 我们以 get_mongodb_collection(collection)函数为例：\ndef get_mongodb_collection(collection):  \"\"\" 根据配置文件和数据库和表得到表（collection） :param database: 数据库 :param collection: 表 :return: 表的对象 \"\"\"  mongo_config = read_mongo_config()  client = pymongo.MongoClient(mongo_config['client'])  db = client[mongo_config['database']]  if mongo_config['auth'] == 'True' or mongo_config['auth'] == 'true':  db.authenticate(mongo_config['username'], mongo_config['password'])  col = db[collection]  return col 在使用Mongo的时候，我们需要先获取其Mongo服务器地址，也就是上文配置文件的client字段内的内容，通过pymongo.MongoClient()方法获取其服务器对象\n然后，使用client[‘数据库名’]选择一个数据库，但选中的数据库可能需要验证用户名密码，所以如果需要验证，则使用db.authenticate(用户名，密码)验证；\n最后，用db[‘集合名’]取出对应的集合即可使用了。\n使用 可以发现，在python里使用mongo，用法和直接敲mongoDB脚本差不多，但是也存在一些不同，比如说‘$and’必须是字符串。\nPython连接Oracle pip装 cx-Oracle（这里注意，会有很多双胞胎几胞胎兄弟，认准这个带横杠的，后面O大写的）。\n这是我之前写的python调用oracle。\nimport cx_Oracle  from utils.dataOperator import insert_data   def start():  conn = cx_Oracle.connect('oracle用户名/oracle密码@IP地址:端口号/oracle用户')  parent_id = '6c9da9e2b17b4e1da967f2fdfa05d89a'  sql = 'select * from 一个表的名字 start with CLASSIFY_ID = \\'' + parent_id + '\\'connect by prior classify_id = parent_id order by seq'  cur = conn.cursor()  cur.execute(sql)  result_list = cur.fetchall()  for result in result_list:  res_obj = {}  res_obj['classify_id'] = str(result[0])  # 一顿操作。。。。  # 在此不表  insert_data('数据库名', '集合名', res_obj) 使用cx_Oracle.connect（注意这里cx_Oracle是下划线了）调用方法，参数是oracle连接字符串\n之后创建一个游标cursor，用它执行sql语句，然后用fetchAll()函数把结果拿回来就可以用了。\n但具体怎么用呢？\n假如CLASSIFY_ID是执行这行sql返回结果中第一列的列名，那么result[0]就是该行数据在该列的值。\n所以需要多加注意。\n","wordCount":"423","inLanguage":"en","datePublished":"2020-02-09T17:06:29+08:00","dateModified":"2020-02-09T17:06:29+08:00","author":{"@type":"Person","name":"JohnathanLin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://windypath.com/posts/python_connect_mongodb_and_oracle/"},"publisher":{"@type":"Organization","name":"风萧古道 - 勤学苦练，年复一年","logo":{"@type":"ImageObject","url":"https://windypath.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://windypath.com/ accesskey=h title="Windypath (Alt + H)">Windypath</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://windypath.com/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://windypath.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://windypath.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://windypath.com/>Home</a>&nbsp;»&nbsp;<a href=https://windypath.com/posts/>Posts</a></div><h1 class=post-title>Python连接MongoDB和Oracle实战</h1><div class=post-meta><span title="2020-02-09 17:06:29 +0800 +0800">February 9, 2020</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;JohnathanLin&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/python_connect_mongodb_and_oracle.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=python连接mongodb>Python连接MongoDB<a hidden class=anchor aria-hidden=true href=#python连接mongodb>#</a></h2><h3 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h3><p>首先要安装pymongo，用pip装一下就好了。</p><h4 id=工具类python文件>工具类python文件<a hidden class=anchor aria-hidden=true href=#工具类python文件>#</a></h4><p>以下直接给出我写的mongodb操作类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#75715e># @Time    : 2019/12/23 14:02</span>
</span></span><span style=display:flex><span><span style=color:#75715e># @Author  : Johnathan Lin 林佳庆</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>数据导入Mongo模块
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pymongo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> utils.configReader <span style=color:#f92672>import</span> read_mongo_config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置编码</span>
</span></span><span style=display:flex><span>os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;NLS_LANG&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SIMPLIFIED CHINESE_CHINA.UTF8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_mongodb_collection</span>(collection):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    根据配置文件和数据库和表得到表（collection）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param database: 数据库
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection: 表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:  表的对象
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    mongo_config <span style=color:#f92672>=</span> read_mongo_config()
</span></span><span style=display:flex><span>    client <span style=color:#f92672>=</span> pymongo<span style=color:#f92672>.</span>MongoClient(mongo_config[<span style=color:#e6db74>&#39;client&#39;</span>])
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> client[mongo_config[<span style=color:#e6db74>&#39;database&#39;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> mongo_config[<span style=color:#e6db74>&#39;auth&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;True&#39;</span> <span style=color:#f92672>or</span> mongo_config[<span style=color:#e6db74>&#39;auth&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;true&#39;</span>:
</span></span><span style=display:flex><span>        db<span style=color:#f92672>.</span>authenticate(mongo_config[<span style=color:#e6db74>&#39;username&#39;</span>], mongo_config[<span style=color:#e6db74>&#39;password&#39;</span>])
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> db[collection]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> col
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>insert_data</span>(collection, document):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    将数据插入MongoDB中
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection:数据将插入的集合名
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param doc:数据文档
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:无
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    col<span style=color:#f92672>.</span>insert_one(document)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>insert_data_list</span>(collection, document_list):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    批量插入数据到MongoDB
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection: 数据将插入的集合名
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param document_list: 数据文档列表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    col<span style=color:#f92672>.</span>insert_many(document_list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_children_classify_id</span>(parent_id):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    获取所有子孙节点
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param parent_id: 父节点ID
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return: 所有子孙节点
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(<span style=color:#e6db74>&#39;crawler_classify&#39;</span>)
</span></span><span style=display:flex><span>    res <span style=color:#f92672>=</span> col<span style=color:#f92672>.</span>aggregate([
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#39;$match&#39;</span>: {<span style=color:#e6db74>&#39;classify_id&#39;</span>: parent_id}},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#39;$graphLookup&#39;</span>: {<span style=color:#e6db74>&#39;from&#39;</span>: <span style=color:#e6db74>&#39;crawler_classify&#39;</span>, <span style=color:#e6db74>&#39;startWith&#39;</span>: <span style=color:#e6db74>&#39;$classify_id&#39;</span>, <span style=color:#e6db74>&#39;connectFromField&#39;</span>: <span style=color:#e6db74>&#39;classify_id&#39;</span>,
</span></span><span style=display:flex><span>                          <span style=color:#e6db74>&#39;connectToField&#39;</span>: <span style=color:#e6db74>&#39;parent_id&#39;</span>, <span style=color:#e6db74>&#39;as&#39;</span>: <span style=color:#e6db74>&#39;son&#39;</span>}}
</span></span><span style=display:flex><span>    ])
</span></span><span style=display:flex><span>    res_list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> doc <span style=color:#f92672>in</span> res:
</span></span><span style=display:flex><span>        res_list<span style=color:#f92672>.</span>append(doc)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(res_list) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>or</span> len(res_list[<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#39;son&#39;</span>]) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [classify[<span style=color:#e6db74>&#39;classify_id&#39;</span>] <span style=color:#66d9ef>for</span> classify <span style=color:#f92672>in</span> res_list[<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#39;son&#39;</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_document_by_condition</span>(collection, key, value):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    根据集合和单一条件查找匹配的文档
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection:  集合名
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param key:  键
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param value: 值
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return: 匹配的文档列表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    res <span style=color:#f92672>=</span> col<span style=color:#f92672>.</span>find({key: value})
</span></span><span style=display:flex><span>    res_list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> doc <span style=color:#f92672>in</span> res:
</span></span><span style=display:flex><span>        res_list<span style=color:#f92672>.</span>append(doc)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> res_list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update_document</span>(collection, condition_key, condition_value, updated_key, new_value):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    更新文档
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param condition_key:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param condition_value:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param updated_key:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param new_value:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    col<span style=color:#f92672>.</span>update({condition_key: condition_value}, {<span style=color:#e6db74>&#39;$set&#39;</span>: {updated_key: new_value}})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_document_by_condition_list</span>(collection, condition_list):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    多条件同时成立查询匹配的文档
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection: 集合名
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param condition_list:  条件列表（列表中的元素为{key:value}形式）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return: 匹配的文档
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    res <span style=color:#f92672>=</span> col<span style=color:#f92672>.</span>find({<span style=color:#e6db74>&#39;$and&#39;</span>: condition_list})
</span></span><span style=display:flex><span>    res_list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> doc <span style=color:#f92672>in</span> res:
</span></span><span style=display:flex><span>        res_list<span style=color:#f92672>.</span>append(doc)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> res_list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>remove_document</span>(collection, condition_list):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    删除文档
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection: 删除文档的集合
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param condition_list:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    col<span style=color:#f92672>.</span>remove({<span style=color:#e6db74>&#39;$and&#39;</span>: condition_list})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update_document_condition_list_and_new_value_obj</span>(collection, condition_list, new_value_obj):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    更新update文档，通过多个用“&amp;”连接的条件和新对象更新
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection: 集合
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param condition_list: 与条件的列表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param new_value_obj: 要更新的新值对象
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> get_mongodb_collection(collection)
</span></span><span style=display:flex><span>    col<span style=color:#f92672>.</span>update({<span style=color:#e6db74>&#39;$and&#39;</span>: condition_list}, {<span style=color:#e6db74>&#39;$set&#39;</span>: new_value_obj})
</span></span></code></pre></div><h4 id=配置文件>配置文件<a hidden class=anchor aria-hidden=true href=#配置文件>#</a></h4><p>配置文件长这样：</p><pre tabindex=0><code class=language-config data-lang=config>[CONFIG]
client=mongodb://localhost:27017/
auth=False
username=xxx
password=xxx
database=yyy
</code></pre><h4 id=获取集合>获取集合<a hidden class=anchor aria-hidden=true href=#获取集合>#</a></h4><p>我们以 get_mongodb_collection(collection)函数为例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_mongodb_collection</span>(collection):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    根据配置文件和数据库和表得到表（collection）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param database: 数据库
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :param collection: 表
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :return:  表的对象
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    mongo_config <span style=color:#f92672>=</span> read_mongo_config()
</span></span><span style=display:flex><span>    client <span style=color:#f92672>=</span> pymongo<span style=color:#f92672>.</span>MongoClient(mongo_config[<span style=color:#e6db74>&#39;client&#39;</span>])
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span> client[mongo_config[<span style=color:#e6db74>&#39;database&#39;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> mongo_config[<span style=color:#e6db74>&#39;auth&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;True&#39;</span> <span style=color:#f92672>or</span> mongo_config[<span style=color:#e6db74>&#39;auth&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;true&#39;</span>:
</span></span><span style=display:flex><span>        db<span style=color:#f92672>.</span>authenticate(mongo_config[<span style=color:#e6db74>&#39;username&#39;</span>], mongo_config[<span style=color:#e6db74>&#39;password&#39;</span>])
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> db[collection]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> col
</span></span></code></pre></div><p>在使用Mongo的时候，我们需要先获取其Mongo服务器地址，也就是上文配置文件的client字段内的内容，通过pymongo.MongoClient()方法获取其服务器对象</p><p>然后，使用client[‘数据库名’]选择一个数据库，但选中的数据库可能需要验证用户名密码，所以如果需要验证，则使用db.authenticate(用户名，密码)验证；</p><p>最后，用db[‘集合名’]取出对应的集合即可使用了。</p><h4 id=使用>使用<a hidden class=anchor aria-hidden=true href=#使用>#</a></h4><p>可以发现，在python里使用mongo，用法和直接敲mongoDB脚本差不多，但是也存在一些不同，比如说‘$and’必须是字符串。</p><h2 id=python连接oracle>Python连接Oracle<a hidden class=anchor aria-hidden=true href=#python连接oracle>#</a></h2><p>pip装 cx-Oracle（这里注意，会有很多双胞胎几胞胎兄弟，认准这个带横杠的，后面O大写的）。</p><p>这是我之前写的python调用oracle。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> cx_Oracle
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> utils.dataOperator <span style=color:#f92672>import</span> insert_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>():
</span></span><span style=display:flex><span>    conn <span style=color:#f92672>=</span> cx_Oracle<span style=color:#f92672>.</span>connect(<span style=color:#e6db74>&#39;oracle用户名/oracle密码@IP地址:端口号/oracle用户&#39;</span>)
</span></span><span style=display:flex><span>    parent_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;6c9da9e2b17b4e1da967f2fdfa05d89a&#39;</span>
</span></span><span style=display:flex><span>    sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;select * from 一个表的名字 start with CLASSIFY_ID = </span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>+</span> parent_id <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>connect by prior classify_id = parent_id order by seq&#39;</span>
</span></span><span style=display:flex><span>    cur <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>    cur<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>    result_list <span style=color:#f92672>=</span> cur<span style=color:#f92672>.</span>fetchall()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> result <span style=color:#f92672>in</span> result_list:
</span></span><span style=display:flex><span>        res_obj <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        res_obj[<span style=color:#e6db74>&#39;classify_id&#39;</span>] <span style=color:#f92672>=</span> str(result[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>        <span style=color:#75715e># 一顿操作。。。。</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 在此不表</span>
</span></span><span style=display:flex><span>        insert_data(<span style=color:#e6db74>&#39;数据库名&#39;</span>, <span style=color:#e6db74>&#39;集合名&#39;</span>, res_obj)
</span></span></code></pre></div><p>使用cx_Oracle.connect（注意这里cx_Oracle是下划线了）调用方法，参数是oracle连接字符串</p><p>之后创建一个游标cursor，用它执行sql语句，然后用fetchAll()函数把结果拿回来就可以用了。</p><p>但具体怎么用呢？</p><p>假如CLASSIFY_ID是执行这行sql返回结果中第一列的列名，那么result[0]就是该行数据在该列的值。</p><p>所以需要多加注意。</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://windypath.com/posts/a_bad_project_crawler_and_email/><span class=title>« Prev Page</span><br><span>一个被废弃的项目——自动爬取信息然后发给我自己邮箱上</span></a>
<a class=next href=https://windypath.com/posts/vue_springboot_deploy_in_linux/><span class=title>Next Page »</span><br><span>vue和springboot项目部署到Linux服务器</span></a></nav></footer></article></main><footer class=footer><span>Windypath 风萧古道 <a href=https://beian.miit.gov.cn/>闽ICP备15016446号-3</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>