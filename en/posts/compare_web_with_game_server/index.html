<!doctype html><html lang=en dir=auto><head><style>:root{--sys-font-family:"Noto Serif SC";--zh-font-family:"Noto Serif SC";--base-font-family:"Noto Serif SC";--code-font-family:"Noto Serif SC";--article-font-family:"Noto Serif SC"}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Traditional Software Server vs. Game Server Architecture Differences | WindyPath - Study And Practice, Years Of It</title>
<meta name=keywords content><meta name=description content="Project Intelligent Customer Service Web Crawler SLG Game Language Java Python Kotlin Model Asynchronous Event Driven There may not be a discernible model Actor Model Transmission Protocol HTTP HTTP TCP + Netty Transmission Structure JSON JSON Protobuf Database Oracle, Redis MongoDB MySQL, Redis Database Framework MyBatis Python Library (similar to JDBC) Hibernate Cache Architecture Redis for Admin Login Status Possibly only caching page numbers All game data is cached, periodically written to the database Configuration Information Only application."><meta name=author content="JohnathanLin"><link rel=canonical href=https://windypath.com/en/posts/compare_web_with_game_server/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.2215af6a28c52331bad04ae84f42d6ac21a53b6982f4d9347e9394a6b1089004.css integrity="sha256-IhWvaijFIzG60EroT0LWrCGlO2mC9Nk0fpOUprEIkAQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://windypath.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://windypath.com/posts/compare_web_with_game_server/><link rel=alternate hreflang=en href=https://windypath.com/en/posts/compare_web_with_game_server/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-MLYM2PFRSJ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MLYM2PFRSJ",{anonymize_ip:!1})}</script><meta property="og:title" content="Traditional Software Server vs. Game Server Architecture Differences"><meta property="og:description" content="Project Intelligent Customer Service Web Crawler SLG Game Language Java Python Kotlin Model Asynchronous Event Driven There may not be a discernible model Actor Model Transmission Protocol HTTP HTTP TCP + Netty Transmission Structure JSON JSON Protobuf Database Oracle, Redis MongoDB MySQL, Redis Database Framework MyBatis Python Library (similar to JDBC) Hibernate Cache Architecture Redis for Admin Login Status Possibly only caching page numbers All game data is cached, periodically written to the database Configuration Information Only application."><meta property="og:type" content="article"><meta property="og:url" content="https://windypath.com/en/posts/compare_web_with_game_server/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-16T18:15:44+08:00"><meta property="article:modified_time" content="2022-04-16T18:15:44+08:00"><meta property="og:site_name" content="Windypath"><meta name=twitter:card content="summary"><meta name=twitter:title content="Traditional Software Server vs. Game Server Architecture Differences"><meta name=twitter:description content="Project Intelligent Customer Service Web Crawler SLG Game Language Java Python Kotlin Model Asynchronous Event Driven There may not be a discernible model Actor Model Transmission Protocol HTTP HTTP TCP + Netty Transmission Structure JSON JSON Protobuf Database Oracle, Redis MongoDB MySQL, Redis Database Framework MyBatis Python Library (similar to JDBC) Hibernate Cache Architecture Redis for Admin Login Status Possibly only caching page numbers All game data is cached, periodically written to the database Configuration Information Only application."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://windypath.com/en/posts/"},{"@type":"ListItem","position":2,"name":"Traditional Software Server vs. Game Server Architecture Differences","item":"https://windypath.com/en/posts/compare_web_with_game_server/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Traditional Software Server vs. Game Server Architecture Differences","name":"Traditional Software Server vs. Game Server Architecture Differences","description":"Project Intelligent Customer Service Web Crawler SLG Game Language Java Python Kotlin Model Asynchronous Event Driven There may not be a discernible model Actor Model Transmission Protocol HTTP HTTP TCP + Netty Transmission Structure JSON JSON Protobuf Database Oracle, Redis MongoDB MySQL, Redis Database Framework MyBatis Python Library (similar to JDBC) Hibernate Cache Architecture Redis for Admin Login Status Possibly only caching page numbers All game data is cached, periodically written to the database Configuration Information Only application.","keywords":[],"articleBody":" Project Intelligent Customer Service Web Crawler SLG Game Language Java Python Kotlin Model Asynchronous Event Driven There may not be a discernible model Actor Model Transmission Protocol HTTP HTTP TCP + Netty Transmission Structure JSON JSON Protobuf Database Oracle, Redis MongoDB MySQL, Redis Database Framework MyBatis Python Library (similar to JDBC) Hibernate Cache Architecture Redis for Admin Login Status Possibly only caching page numbers All game data is cached, periodically written to the database Configuration Information Only application.properties config.ini Zookeeper, pre-loading design table information into ZK Concurrency No concurrency (so no need for locks) Python multi-threading for simultaneous web crawling No concurrency, Actor model ensures only one task at a time Hot Reload Directly restart N/A Inherit a method from a certain class, replace the online class Architecture Overview Intelligent Customer Service Server Overall Architecture Deployment of Soldiers in SLG Game Typical Case Intelligent Customer Service Chat graph LR A[Client]--\u003e|HTTP chat message|B[Intelligent Customer Service System]--\u003e|Place chat message in message queue|C[Intelligent Q\u0026A Model]--\u003e|Record Q\u0026A information|D[Oracle Database] Deployment of Soldiers in SLG Game graph LR A[Client]--\u003e|Protobuf sent via TCP|B[Gate's Netty Unpacking]--\u003e|Internal message forwarding in actor|C[WorldActor verifies various states of the outer city sand table]--\u003e|Internal message forwarding in actor|D[PlayerActor verifies and retrieves buffs in the inner city] Both WorldActor and PlayerActor retrieve the required data by reading from memory, and do not directly read from the MySQL database. The data in memory is updated to MySQL using Hibernate methods for changes every certain period of time (around 30 seconds).\nConfiguration Information Loading For the intelligent customer service, due to low concurrency and business volume (because there are relatively few platforms for deployment, and almost no one uses it in the early morning, and the restart speed is very fast), some configuration values on demand (such as how many times “transfer to human” needs to be sent before entering the human transfer channel) are hard-coded directly into the business logic. Some configuration information, such as the request address URLs of other systems, will be placed in application.properties. Excel is not used to centrally store configuration information for various functional modules, and it is indeed not necessary.\nHowever, for the game, configuration values are crucial, closely related to gameplay, rewards, and the in-game ecosystem. Therefore, in the game server, almost all values need to be read from the configuration table. Currently, Excel is probably the most powerful software for handling data, and designers can quickly set up values through Excel.\nWhen starting the server, you need to read the configuration table into memory (in a broad sense). However, with tools like Zookeeper, configuration table data can be stored in ZK and retrieved when needed.\nAdvantages of Game Servers Transmission Structure is Protobuf The data received and sent by the server are all in binary format converted from ProtoBuf, thereby achieving a unified transmission structure between the client and server. ProtoBuf has its own functionality for encoding and decoding binary data, which minimizes the size of message data. Encoding and decoding are executed by Netty, so all you need to do is pass the objects generated by ProtoBuf to Netty. The ProtoBuf version used here is v2, which includes three keywords: required, optional, and repeated, each providing constraints on the properties within the transmitted message.\nAkka Actor Architecture The Actor architecture implements single-threaded business logic, eliminating the need to lock common properties during development. Through internal message communication, data processing proceeds in an orderly manner. Akka cluster provides dynamic load balancing, allowing for parallel expansion. In other words, if a server can’t handle the concurrency, simply configure one or more new servers and add them to the cluster for load balancing.\nConfiguration Table Information Stored in Zookeeper By reading Excel data table information into Java code, converting it into binary, and placing it in Zookeeper, configuration table hot updates can be achieved, making it possible to read it at any time.\nData Cached in Memory after Server Startup, Periodically Flushed into the Database The game server does not directly manipulate the database, but rather operates on data in memory. The data in memory is updated to the database at regular intervals. Consequently, even in cases of very high concurrent I/O, modifications are made only to the data in memory and do not directly affect the database.\nProblems Existing in Both Systems Intelligent Customer Service Inefficient Oracle Joins for Extracting Reports, Lack of Read-Write Separation The reports in the intelligent customer service system are real-time and are written in a very long SQL query using union. As a result, the query speed is very slow. In the production environment, selecting a time interval of more than 14 days and checking multiple report evaluation items leads to a query time of over 30 seconds. This means the SQL query took nearly 30 seconds to execute. We always talked about optimizing it, but in the end, we didn’t come up with any effective solutions.\nLater, I also encountered some reports. Generally, raw and unprocessed data is sent to another log collection library through a message queue, which may be called a data warehouse. Then, another system extracts and aggregates data from the data warehouse.\nAnother approach is to only query data before today when extracting reports, and then execute a scheduled task after 24:00 at the end of each day to update report data.\nOf course, all of these measures result in the inability to display the latest report data in real time, which is also a trade-off.\nPoorly Designed Chat Record Logging Each row in the chat record table contains various information about the sender and the chat session, storing too many states (because there are special messages like chat record evaluations, the structure has undergone significant changes). It is possible that initially only text was considered, then images were added (which support HTML and have HTML injection risks), and later the “Guess You Want to Ask” bubbles were introduced. However, “Guess You Want to Ask” itself is not included in the chat record, requiring special handling.\nDue to a lack of refactoring, both the front-end and back-end code became very messy as development progressed.\nSLG Game Server Hot Update Issues The larger the project, the more problems we encounter. The more problems there are, the faster we want to fix and update them in the production environment. Thanks to Java’s inheritance feature, we can achieve seamless hot updates for online players by inheriting a class with business logic, rewriting a problematic function, and correcting it with the correct business logic. However, this cannot cover every online problem. In addition to business logic classes, there are also data processing and storage classes, which cannot be hot updated because they are closely associated with the logic of scheduled data writing. Some business logic written by developers in data processing and storage classes cannot be hot updated.\nAdditionally, some properties have been marked with the private identifier, making it impossible to directly retrieve them. Reflection must be used to access them.\nCommunication Between Nodes Akka Actor is single-threaded, but this does not mean the entire system is single-threaded. To improve efficiency, we have divided the system into different Actors based on business logic and functionality modules, such as the gateway Gate, the outer city sandbox World, the inner city player Home, the alliance Alliance, and the global ranking Rank. However, as a result, some data that should have been shared by multiple nodes needs to be synchronized using internal messages.\nFor example, there is an operation activity related to a person attacking a monster on the sandbox, which adds points to themselves and their alliance. In this case, the World, Home, and Alliance nodes each need to store a copy of the activity’s start and end times. Of course, there is another way, which is to allocate a JSON object on Zookeeper to store the current activity information. However, if all complex activities use this method, Zookeeper will end up storing too much rarely used data.\nOther Systems Intelligent Customer Service Edge System: Knowledge Base System The original intention was to extract the linguistic information of the intelligent customer service as a separate subsystem. However, due to the tight association between the linguistic information and the core of the intelligent customer service, it was not possible to separate them.\nTo implement fuzzy queries, Elasticsearch (ES) was used as the storage database. However, there is a contradiction between relational databases and non-relational databases. Relational databases are convenient for managing data and reducing data redundancy but lose the ability to perform fuzzy queries and inverted indexing in ES. Using only a non-relational database would prevent direct associations with tables in other databases within the system, necessitating the use of services to obtain resources and increasing system overhead. If both a relational database like Oracle and a non-relational database like ES store a copy, the problem of data synchronization arises. It would require scheduled tasks to synchronize the two databases, and even the need for discrimination between the two databases, similar to version control systems like Git and SVN.\nGame Server: Operations GM Sending patches to the live servers, replacing the implementation of a specific method in a specific class on the live servers, thereby achieving seamless hot updates for players. Sending Groovy scripts to the live servers and executing business logic written in Groovy on the live servers. ","wordCount":"1556","inLanguage":"en","datePublished":"2022-04-16T18:15:44+08:00","dateModified":"2022-04-16T18:15:44+08:00","author":{"@type":"Person","name":"JohnathanLin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://windypath.com/en/posts/compare_web_with_game_server/"},"publisher":{"@type":"Organization","name":"WindyPath - Study And Practice, Years Of It","logo":{"@type":"ImageObject","url":"https://windypath.com/%3Clink%20/%20abs%20url%3E"}}}</script><script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MLYM2PFRSJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MLYM2PFRSJ")</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://windypath.com/en/ accesskey=h title="Windypath (Alt + H)">Windypath</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://windypath.com/ title=点击这里切换中文网站 aria-label=点击这里切换中文网站>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://windypath.com/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://windypath.com/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://windypath.com/en/about/ title=About><span>About</span></a></li><li><a href=https://windypath.com/en/mybooks/ title="My Books"><span>My Books</span></a></li><li><a href=https://windypath.com/en/myfriends/ title="My Friends"><span>My Friends</span></a></li><li><a href=https://windypath.com/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Traditional Software Server vs. Game Server Architecture Differences</h1><div class=post-meta>&lt;span title='2022-04-16 18:15:44 +0800 +0800'>April 16, 2022&lt;/span>&amp;nbsp;·&amp;nbsp;JohnathanLin&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://windypath.com/posts/compare_web_with_game_server/>Zh</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#architecture-overview aria-label="Architecture Overview">Architecture Overview</a><ul><li><a href=#intelligent-customer-service-server-overall-architecture aria-label="Intelligent Customer Service Server Overall Architecture">Intelligent Customer Service Server Overall Architecture</a></li><li><a href=#deployment-of-soldiers-in-slg-game aria-label="Deployment of Soldiers in SLG Game">Deployment of Soldiers in SLG Game</a></li></ul></li><li><a href=#typical-case aria-label="Typical Case">Typical Case</a><ul><li><a href=#intelligent-customer-service-chat aria-label="Intelligent Customer Service Chat">Intelligent Customer Service Chat</a></li><li><a href=#deployment-of-soldiers-in-slg-game-1 aria-label="Deployment of Soldiers in SLG Game">Deployment of Soldiers in SLG Game</a></li></ul></li><li><a href=#configuration-information-loading aria-label="Configuration Information Loading">Configuration Information Loading</a></li><li><a href=#advantages-of-game-servers aria-label="Advantages of Game Servers">Advantages of Game Servers</a><ul><li><a href=#transmission-structure-is-protobuf aria-label="Transmission Structure is Protobuf">Transmission Structure is Protobuf</a></li><li><a href=#akka-actor-architecture aria-label="Akka Actor Architecture">Akka Actor Architecture</a></li><li><a href=#configuration-table-information-stored-in-zookeeper aria-label="Configuration Table Information Stored in Zookeeper">Configuration Table Information Stored in Zookeeper</a></li><li><a href=#data-cached-in-memory-after-server-startup-periodically-flushed-into-the-database aria-label="Data Cached in Memory after Server Startup, Periodically Flushed into the Database">Data Cached in Memory after Server Startup, Periodically Flushed into the Database</a></li></ul></li><li><a href=#problems-existing-in-both-systems aria-label="Problems Existing in Both Systems">Problems Existing in Both Systems</a><ul><li><a href=#intelligent-customer-service aria-label="Intelligent Customer Service">Intelligent Customer Service</a><ul><li><a href=#inefficient-oracle-joins-for-extracting-reports-lack-of-read-write-separation aria-label="Inefficient Oracle Joins for Extracting Reports, Lack of Read-Write Separation">Inefficient Oracle Joins for Extracting Reports, Lack of Read-Write Separation</a></li><li><a href=#poorly-designed-chat-record-logging aria-label="Poorly Designed Chat Record Logging">Poorly Designed Chat Record Logging</a></li></ul></li><li><a href=#slg-game-server aria-label="SLG Game Server">SLG Game Server</a><ul><li><a href=#hot-update-issues aria-label="Hot Update Issues">Hot Update Issues</a></li><li><a href=#communication-between-nodes aria-label="Communication Between Nodes">Communication Between Nodes</a></li></ul></li></ul></li><li><a href=#other-systems aria-label="Other Systems">Other Systems</a><ul><li><a href=#intelligent-customer-service-edge-system-knowledge-base-system aria-label="Intelligent Customer Service Edge System: Knowledge Base System">Intelligent Customer Service Edge System: Knowledge Base System</a></li><li><a href=#game-server-operations-gm aria-label="Game Server: Operations GM">Game Server: Operations GM</a></li></ul></li></ul></div></details></div><div class=post-content><table><thead><tr><th style=text-align:center>Project</th><th style=text-align:center>Intelligent Customer Service</th><th style=text-align:center>Web Crawler</th><th style=text-align:center>SLG Game</th></tr></thead><tbody><tr><td style=text-align:center>Language</td><td style=text-align:center>Java</td><td style=text-align:center>Python</td><td style=text-align:center>Kotlin</td></tr><tr><td style=text-align:center>Model</td><td style=text-align:center>Asynchronous Event Driven</td><td style=text-align:center>There may not be a discernible model</td><td style=text-align:center>Actor Model</td></tr><tr><td style=text-align:center>Transmission Protocol</td><td style=text-align:center>HTTP</td><td style=text-align:center>HTTP</td><td style=text-align:center>TCP + Netty</td></tr><tr><td style=text-align:center>Transmission Structure</td><td style=text-align:center>JSON</td><td style=text-align:center>JSON</td><td style=text-align:center>Protobuf</td></tr><tr><td style=text-align:center>Database</td><td style=text-align:center>Oracle, Redis</td><td style=text-align:center>MongoDB</td><td style=text-align:center>MySQL, Redis</td></tr><tr><td style=text-align:center>Database Framework</td><td style=text-align:center>MyBatis</td><td style=text-align:center>Python Library (similar to JDBC)</td><td style=text-align:center>Hibernate</td></tr><tr><td style=text-align:center>Cache Architecture</td><td style=text-align:center>Redis for Admin Login Status</td><td style=text-align:center>Possibly only caching page numbers</td><td style=text-align:center>All game data is cached, periodically written to the database</td></tr><tr><td style=text-align:center>Configuration Information</td><td style=text-align:center>Only <code>application.properties</code></td><td style=text-align:center><code>config.ini</code></td><td style=text-align:center>Zookeeper, pre-loading design table information into ZK</td></tr><tr><td style=text-align:center>Concurrency</td><td style=text-align:center>No concurrency (so no need for locks)</td><td style=text-align:center>Python multi-threading for simultaneous web crawling</td><td style=text-align:center>No concurrency, Actor model ensures only one task at a time</td></tr><tr><td style=text-align:center>Hot Reload</td><td style=text-align:center>Directly restart</td><td style=text-align:center>N/A</td><td style=text-align:center>Inherit a method from a certain class, replace the online class</td></tr></tbody></table><h2 id=architecture-overview>Architecture Overview<a hidden class=anchor aria-hidden=true href=#architecture-overview>#</a></h2><h3 id=intelligent-customer-service-server-overall-architecture>Intelligent Customer Service Server Overall Architecture<a hidden class=anchor aria-hidden=true href=#intelligent-customer-service-server-overall-architecture>#</a></h3><p><img loading=lazy src=/images/%e6%99%ba%e8%83%bd%e5%ae%a2%e6%9c%8d%e6%9c%8d%e5%8a%a1%e7%ab%af%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84.png alt="Overall Architecture of Intelligent Customer Service Server"></p><h3 id=deployment-of-soldiers-in-slg-game>Deployment of Soldiers in SLG Game<a hidden class=anchor aria-hidden=true href=#deployment-of-soldiers-in-slg-game>#</a></h3><p><img loading=lazy src=/images/SLG%e6%b8%b8%e6%88%8f%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84.png alt="Overall Architecture of SLG Game"></p><h2 id=typical-case>Typical Case<a hidden class=anchor aria-hidden=true href=#typical-case>#</a></h2><h3 id=intelligent-customer-service-chat>Intelligent Customer Service Chat<a hidden class=anchor aria-hidden=true href=#intelligent-customer-service-chat>#</a></h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR
A[Client]--&gt;|HTTP chat message|B[Intelligent Customer Service System]--&gt;|Place chat message in message queue|C[Intelligent Q&amp;A Model]--&gt;|Record Q&amp;A information|D[Oracle Database]
</code></pre><h3 id=deployment-of-soldiers-in-slg-game-1>Deployment of Soldiers in SLG Game<a hidden class=anchor aria-hidden=true href=#deployment-of-soldiers-in-slg-game-1>#</a></h3><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR
A[Client]--&gt;|Protobuf sent via TCP|B[Gate&#39;s Netty Unpacking]--&gt;|Internal message forwarding in actor|C[WorldActor verifies various states of the outer city sand table]--&gt;|Internal message forwarding in actor|D[PlayerActor verifies and retrieves buffs in the inner city]
</code></pre><p>Both WorldActor and PlayerActor retrieve the required data by reading from memory, and do not directly read from the MySQL database. The data in memory is updated to MySQL using Hibernate methods for changes every certain period of time (around 30 seconds).</p><h2 id=configuration-information-loading>Configuration Information Loading<a hidden class=anchor aria-hidden=true href=#configuration-information-loading>#</a></h2><p>For the intelligent customer service, due to low concurrency and business volume (because there are relatively few platforms for deployment, and almost no one uses it in the early morning, and the restart speed is very fast), some configuration values on demand (such as how many times &ldquo;transfer to human&rdquo; needs to be sent before entering the human transfer channel) are hard-coded directly into the business logic. Some configuration information, such as the request address URLs of other systems, will be placed in <code>application.properties</code>. Excel is not used to centrally store configuration information for various functional modules, and it is indeed not necessary.</p><p>However, for the game, configuration values are crucial, closely related to gameplay, rewards, and the in-game ecosystem. Therefore, in the game server, almost all values need to be read from the configuration table. Currently, Excel is probably the most powerful software for handling data, and designers can quickly set up values through Excel.</p><p>When starting the server, you need to read the configuration table into memory (in a broad sense). However, with tools like Zookeeper, configuration table data can be stored in ZK and retrieved when needed.</p><h2 id=advantages-of-game-servers>Advantages of Game Servers<a hidden class=anchor aria-hidden=true href=#advantages-of-game-servers>#</a></h2><h3 id=transmission-structure-is-protobuf>Transmission Structure is Protobuf<a hidden class=anchor aria-hidden=true href=#transmission-structure-is-protobuf>#</a></h3><p>The data received and sent by the server are all in binary format converted from ProtoBuf, thereby achieving a unified transmission structure between the client and server. ProtoBuf has its own functionality for encoding and decoding binary data, which minimizes the size of message data. Encoding and decoding are executed by Netty, so all you need to do is pass the objects generated by ProtoBuf to Netty. The ProtoBuf version used here is v2, which includes three keywords: <code>required</code>, <code>optional</code>, and <code>repeated</code>, each providing constraints on the properties within the transmitted message.</p><h3 id=akka-actor-architecture>Akka Actor Architecture<a hidden class=anchor aria-hidden=true href=#akka-actor-architecture>#</a></h3><p>The Actor architecture implements single-threaded business logic, eliminating the need to lock common properties during development. Through internal message communication, data processing proceeds in an orderly manner. Akka cluster provides dynamic load balancing, allowing for parallel expansion. In other words, if a server can&rsquo;t handle the concurrency, simply configure one or more new servers and add them to the cluster for load balancing.</p><h3 id=configuration-table-information-stored-in-zookeeper>Configuration Table Information Stored in Zookeeper<a hidden class=anchor aria-hidden=true href=#configuration-table-information-stored-in-zookeeper>#</a></h3><p>By reading Excel data table information into Java code, converting it into binary, and placing it in Zookeeper, configuration table hot updates can be achieved, making it possible to read it at any time.</p><h3 id=data-cached-in-memory-after-server-startup-periodically-flushed-into-the-database>Data Cached in Memory after Server Startup, Periodically Flushed into the Database<a hidden class=anchor aria-hidden=true href=#data-cached-in-memory-after-server-startup-periodically-flushed-into-the-database>#</a></h3><p>The game server does not directly manipulate the database, but rather operates on data in memory. The data in memory is updated to the database at regular intervals. Consequently, even in cases of very high concurrent I/O, modifications are made only to the data in memory and do not directly affect the database.</p><h2 id=problems-existing-in-both-systems>Problems Existing in Both Systems<a hidden class=anchor aria-hidden=true href=#problems-existing-in-both-systems>#</a></h2><h3 id=intelligent-customer-service>Intelligent Customer Service<a hidden class=anchor aria-hidden=true href=#intelligent-customer-service>#</a></h3><h4 id=inefficient-oracle-joins-for-extracting-reports-lack-of-read-write-separation>Inefficient Oracle Joins for Extracting Reports, Lack of Read-Write Separation<a hidden class=anchor aria-hidden=true href=#inefficient-oracle-joins-for-extracting-reports-lack-of-read-write-separation>#</a></h4><p>The reports in the intelligent customer service system are real-time and are written in a very long SQL query using <code>union</code>. As a result, the query speed is very slow. In the production environment, selecting a time interval of more than 14 days and checking multiple report evaluation items leads to a query time of over 30 seconds. This means the SQL query took nearly 30 seconds to execute. We always talked about optimizing it, but in the end, we didn&rsquo;t come up with any effective solutions.</p><p>Later, I also encountered some reports. Generally, raw and unprocessed data is sent to another log collection library through a message queue, which may be called a data warehouse. Then, another system extracts and aggregates data from the data warehouse.</p><p>Another approach is to only query data before today when extracting reports, and then execute a scheduled task after 24:00 at the end of each day to update report data.</p><p>Of course, all of these measures result in the inability to display the latest report data in real time, which is also a trade-off.</p><h4 id=poorly-designed-chat-record-logging>Poorly Designed Chat Record Logging<a hidden class=anchor aria-hidden=true href=#poorly-designed-chat-record-logging>#</a></h4><p>Each row in the chat record table contains various information about the sender and the chat session, storing too many states (because there are special messages like chat record evaluations, the structure has undergone significant changes). It is possible that initially only text was considered, then images were added (which support HTML and have HTML injection risks), and later the &ldquo;Guess You Want to Ask&rdquo; bubbles were introduced. However, &ldquo;Guess You Want to Ask&rdquo; itself is not included in the chat record, requiring special handling.</p><p>Due to a lack of refactoring, both the front-end and back-end code became very messy as development progressed.</p><h3 id=slg-game-server>SLG Game Server<a hidden class=anchor aria-hidden=true href=#slg-game-server>#</a></h3><h4 id=hot-update-issues>Hot Update Issues<a hidden class=anchor aria-hidden=true href=#hot-update-issues>#</a></h4><p>The larger the project, the more problems we encounter. The more problems there are, the faster we want to fix and update them in the production environment. Thanks to Java&rsquo;s inheritance feature, we can achieve seamless hot updates for online players by inheriting a class with business logic, rewriting a problematic function, and correcting it with the correct business logic. However, this cannot cover every online problem. In addition to business logic classes, there are also data processing and storage classes, which cannot be hot updated because they are closely associated with the logic of scheduled data writing. Some business logic written by developers in data processing and storage classes cannot be hot updated.</p><p>Additionally, some properties have been marked with the <code>private</code> identifier, making it impossible to directly retrieve them. Reflection must be used to access them.</p><h4 id=communication-between-nodes>Communication Between Nodes<a hidden class=anchor aria-hidden=true href=#communication-between-nodes>#</a></h4><p>Akka Actor is single-threaded, but this does not mean the entire system is single-threaded. To improve efficiency, we have divided the system into different Actors based on business logic and functionality modules, such as the gateway <code>Gate</code>, the outer city sandbox <code>World</code>, the inner city player <code>Home</code>, the alliance <code>Alliance</code>, and the global ranking <code>Rank</code>. However, as a result, some data that should have been shared by multiple nodes needs to be synchronized using internal messages.</p><p>For example, there is an operation activity related to a person attacking a monster on the sandbox, which adds points to themselves and their alliance. In this case, the <code>World</code>, <code>Home</code>, and <code>Alliance</code> nodes each need to store a copy of the activity&rsquo;s start and end times. Of course, there is another way, which is to allocate a JSON object on Zookeeper to store the current activity information. However, if all complex activities use this method, Zookeeper will end up storing too much rarely used data.</p><h2 id=other-systems>Other Systems<a hidden class=anchor aria-hidden=true href=#other-systems>#</a></h2><h3 id=intelligent-customer-service-edge-system-knowledge-base-system>Intelligent Customer Service Edge System: Knowledge Base System<a hidden class=anchor aria-hidden=true href=#intelligent-customer-service-edge-system-knowledge-base-system>#</a></h3><p>The original intention was to extract the linguistic information of the intelligent customer service as a separate subsystem. However, due to the tight association between the linguistic information and the core of the intelligent customer service, it was not possible to separate them.</p><p>To implement fuzzy queries, Elasticsearch (ES) was used as the storage database. However, there is a contradiction between relational databases and non-relational databases. Relational databases are convenient for managing data and reducing data redundancy but lose the ability to perform fuzzy queries and inverted indexing in ES. Using only a non-relational database would prevent direct associations with tables in other databases within the system, necessitating the use of services to obtain resources and increasing system overhead. If both a relational database like Oracle and a non-relational database like ES store a copy, the problem of data synchronization arises. It would require scheduled tasks to synchronize the two databases, and even the need for discrimination between the two databases, similar to version control systems like Git and SVN.</p><h3 id=game-server-operations-gm>Game Server: Operations GM<a hidden class=anchor aria-hidden=true href=#game-server-operations-gm>#</a></h3><ul><li>Sending patches to the live servers, replacing the implementation of a specific method in a specific class on the live servers, thereby achieving seamless hot updates for players.</li><li>Sending Groovy scripts to the live servers and executing business logic written in Groovy on the live servers.</li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://windypath.com/en/posts/linux_socket_programming/><span class=title>« Prev</span><br><span>Linux C++ Socket in Action</span></a></nav></footer></article></main><footer class=footer><span>Windypath 风萧古道 <strong>For Chinese Software</strong>. <a href=https://beian.miit.gov.cn/>闽ICP备15016446号-3</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>